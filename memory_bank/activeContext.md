# 活跃上下文

## 当前工作焦点

### 项目状态

- **阶段**: 项目重新定位和架构调整阶段
- **重点**: 从通用管理后台转向AI视频服务平台
- **优先级**: 核心AI工具集成 > 资产管理系统 > 用户体验优化
- **最新进展**:
  - ✅ 完成代码质量保障体系建设
  - ✅ 更新Pinia持久化存储插件

### 最近的重要变化

#### ✅ Pinia持久化插件更新 (2024-12)

1. **从 pinia-plugin-persist 迁移到 pinia-plugin-persistedstate**

   - 更新了所有store的持久化配置格式
   - 统一使用`pick`属性替代原来的`paths`属性
   - 移除了旧的`enabled`与`strategies`配置
   - 配置格式与authStore保持一致

2. **影响的文件**

   - stableDiffusionStore.ts
   - speechStore.ts
   - snackbarStore.ts
   - profileStore.ts
   - customizeTheme.ts
   - chatHistoryStore.ts
   - chatGPTStore.ts
   - appStore.ts

3. **新的持久化配置示例**
   ```javascript
   persist: {
     storage: localStorage,
     pick: ['isLoggedIn', 'user'],
   }
   ```

#### ✅ 代码质量保障体系建设完成 (2024-12)

1. **ESLint 配置完善**

   - 配置了完整的 ESLint v9 规则，完美支持 Vue 3 + TypeScript
   - 实现了 Vue 单文件组件的正确解析和检查
   - 建立了合理的错误和警告分级制度
   - 支持自动修复大部分代码风格问题

2. **Husky + CommitLint 工作流**

   - Pre-commit hook: 自动运行 ESLint 和 Prettier 格式化
   - Commit-msg hook: 强制使用 Conventional Commits 规范
   - Lint-staged: 只对暂存文件运行检查，提高效率
   - 建立了完整的代码提交质量控制流程

3. **开发体验优化**
   - 配置了 Prettier 代码格式化规则
   - 建立了统一的代码风格标准
   - 提供了完整的 npm scripts 用于代码检查和格式化
   - 创建了详细的使用说明文档

#### 项目重新定位 🎯

1. **项目方向调整**

   - 从通用管理后台转向AI视频服务平台
   - 专注于AI视频工具的整合和小工具集合
   - 采用独立聚合模式，不做功能耦合

2. **核心目标重新定义**
   - 账号统一：一个账号可以使用N个模型
   - 资产统一：脚本、创意、图片、视频、音乐等按项目管理
   - 模型可以逐步接入

#### 一期核心功能规划 🎯

1. **账号系统**

   - 简化账号体系（测试账号生成即可）
   - 统一账号管理，支持多模型使用
   - 基础的用户认证功能

2. **创意策划模块**

   - 集成AI文本生成模型：Deepseek、豆包、Kimi
   - 用户可选择不同模型生成创意文本
   - 创意内容的保存和管理

3. **图片生成模块**

   - 集成图片生成模型：即梦、豆包、通义万相
   - 核心功能：文字生图、参考图生图、比例尺寸设置
   - 界面参考即梦设计，增加模型选择功能

4. **视频生成模块**

   - 集成Vidu视频生成模型：Vidu 2.0、Vidu Q1
   - 核心功能：文生视频、图生视频、首尾帧、参考生视频
   - 设置项参考Vidu官方界面

5. **资产管理系统**
   - 项目化管理：脚本、创意文档、图片、视频、音乐
   - 资产分类和检索功能
   - 项目协作功能

#### 已有基础功能保留 ✅

- 主题系统（明暗主题切换、主题色切换）
- 国际化支持
- 响应式布局
- 基础的用户认证框架
- **✅ 完整的代码质量保障体系**
- **✅ 更新的Pinia持久化存储方案**

## 当前技术决策

### 状态管理配置 ✅

1. **Pinia + 持久化存储**
   - 使用 pinia-plugin-persistedstate 替代了原有的 pinia-plugin-persist
   - 统一的持久化配置格式：使用 `pick` 指定需要持久化的状态
   - 使用 localStorage 作为默认存储方式
   - 示例配置:
   ```javascript
   persist: {
     storage: localStorage,
     pick: ['key1', 'key2', 'key3'],
   }
   ```

### 代码质量标准 ✅

1. **ESLint 规则配置**

   - 支持 Vue 3 单文件组件完整解析
   - TypeScript 语法检查和类型安全
   - Vue 特定规则：组件命名、属性顺序、模板语法等
   - 合理的错误/警告分级，专注重要问题

2. **代码提交规范**

   - 强制使用 Conventional Commits 格式
   - 支持的提交类型：feat, fix, docs, style, refactor, perf, test, chore, revert, build, ci
   - 自动代码格式化和错误修复
   - 提交前质量检查，确保代码质量

3. **开发工作流**

   ```bash
   # 日常开发命令
   pnpm run lint:check    # 检查代码风格
   pnpm run lint          # 检查并自动修复
   pnpm run format        # 格式化代码

   # 提交规范示例
   git commit -m "feat: add new feature"
   git commit -m "fix: resolve bug in component"
   git commit -m "docs: update readme"
   ```

### 架构设计原则

1. **独立聚合原则**

   - 各AI工具模块独立开发，不做功能耦合
   - 统一的用户界面和交互体验
   - 模块化的API集成方式
   - 便于后续模型的接入和替换

2. **项目化管理**
   - 以项目为单位组织所有创作资源
   - 支持项目的创建、编辑、分享
   - 资产在项目内的关联和引用
   - 项目模板和快速创建功能

### AI模型集成策略

1. **文本生成模型**

   - Deepseek API集成
   - 豆包API集成
   - Kimi API集成
   - 统一的文本生成接口抽象

2. **图片生成模型**

   - 即梦API集成
   - 豆包图片生成API
   - 通义万相API集成
   - 统一的图片生成参数配置

3. **视频生成模型**
   - Vidu 2.0 API集成
   - Vidu Q1 API集成
   - 视频生成参数统一管理
   - 生成进度和状态跟踪

### 重要的技术约束

- **浏览器支持**: 现代浏览器优先
- **性能要求**: AI模型响应时间 < 30秒
- **文件处理**: 支持大文件上传和处理
- **TypeScript**: 强制类型安全
- **模块化**: 各AI工具模块独立，便于扩展
- **认证机制**: 使用 httpOnly Cookie，API层统一处理401错误和登录跳转
- **✅ 代码质量**: 强制代码风格检查，确保代码质量和一致性

## 开发模式和偏好

### 代码风格偏好 ✅

- **组合式API**: 优先使用`<script setup>`语法
- **类型安全**: 所有组件和函数都要有类型定义
- **模块化**: AI工具按模块划分，避免功能耦合
- **可扩展性**: 新模型接入要简单快速
- **✅ 代码规范**: 遵循 ESLint 和 Prettier 配置的代码风格
- **✅ 提交规范**: 使用 Conventional Commits 格式
- **✅ 状态持久化**: 使用 pinia-plugin-persistedstate 配置持久化存储

### 组件设计原则

1. **模块独立**: 每个AI工具模块独立开发和维护
2. **接口统一**: 相同类型的AI工具使用统一的接口规范
3. **配置驱动**: 通过配置文件管理模型参数和设置
4. **响应式**: 所有组件都要支持响应式设计
5. **✅ 质量保证**: 所有组件都要通过 ESLint 检查

### 状态管理策略

- **模块化状态**: 每个AI工具模块有独立的状态管理
- **项目状态**: 项目和资产管理的全局状态
- **用户状态**: 用户信息和偏好设置
- **✅ 持久化**: 使用 pinia-plugin-persistedstate 实现重要状态数据持久化存储
- **持久化范围**: 只持久化必要的状态，避免敏感数据持久化

## 当前挑战和解决方案

### 技术挑战

1. **多AI模型集成**

   - **问题**: 不同AI模型API接口差异大
   - **解决方案**: 设计统一的抽象层，封装各模型差异
   - **状态**: 架构设计中

2. **大文件处理**

   - **问题**: 视频文件上传和处理性能
   - **解决方案**: 分片上传、进度跟踪、后台处理
   - **状态**: 技术调研中

3. **资产管理复杂度**
   - **问题**: 项目化管理的数据结构设计
   - **解决方案**: 设计灵活的资产关联模型
   - **状态**: 数据模型设计中

### 业务挑战

1. **用户体验统一**

   - **问题**: 不同AI工具的交互模式差异
   - **解决方案**: 设计统一的UI/UX规范
   - **状态**: 设计规范制定中

2. **模型选择策略**
   - **问题**: 用户如何选择最适合的模型
   - **解决方案**: 提供模型推荐和对比功能
   - **状态**: 产品设计中

## 即将进行的工作

### 短期计划（2-4周）

1. **架构设计完善**

   - AI模型抽象层设计
   - 项目和资产数据模型设计
   - API接口规范定义

2. **核心模块开发**

   - 创意策划模块基础框架
   - 图片生成模块基础框架
   - 视频生成模块基础框架

3. **基础设施搭建**
   - 项目管理系统
   - 资产存储和管理
   - 用户权限系统

### 中期计划（1-2个月）

1. **AI模型集成**

   - Deepseek、豆包、Kimi文本模型集成
   - 即梦、豆包、通义万相图片模型集成
   - Vidu视频模型集成

2. **功能完善**

   - 完整的创作流程实现
   - 资产管理功能完善
   - 用户体验优化

3. **测试和优化**
   - 功能测试和性能优化
   - 用户体验测试
   - 系统稳定性测试

## 学习和洞察

### 技术洞察

1. **AI模型集成**: 需要设计灵活的抽象层来处理不同模型的差异
2. **资产管理**: 项目化管理需要考虑资产的版本控制和关联关系
3. **用户体验**: 统一的交互模式对用户学习成本很重要
4. **认证架构优化**: API层统一处理401错误比路由守卫验证更高效，减少不必要的API调用
5. **✅ 代码质量保障**: 完整的 ESLint + Husky + CommitLint 工作流能显著提高代码质量和团队协作效率
6. **✅ 状态管理优化**: 更新到新版的 pinia-plugin-persistedstate 简化了配置，减少了重复代码

### 产品洞察

1. **工具整合价值**: 用户确实需要统一的AI工具平台
2. **项目化管理**: 按项目组织资产符合用户的工作习惯
3. **模型选择**: 提供多种模型选择能满足不同场景需求

### 开发流程洞察

1. **模块化开发**: 独立模块开发能提高开发效率
2. **接口标准化**: 统一的接口规范对团队协作很重要
3. **渐进式集成**: 逐步接入模型能降低开发风险
4. **✅ 质量控制**: 自动化的代码质量检查能有效防止低质量代码进入主分支
5. **✅ 依赖管理**: 及时更新核心依赖并适配新API有助于项目长期健康发展

## 待决定的问题

### 技术问题

1. **AI模型调用频率限制**: 如何处理不同模型的调用限制和计费
2. **文件存储策略**: 本地存储 vs 云存储的选择
3. **实时通信**: 是否需要WebSocket支持实时生成进度
4. **缓存策略**: AI生成结果的缓存机制设计

### 产品问题

1. **用户引导**: 如何帮助用户快速上手多种AI工具
2. **结果评价**: 如何让用户评价和改进AI生成结果
3. **协作机制**: 团队协作的具体实现方式
4. **定价策略**: 如何平衡免费和付费功能

## 重要提醒

### 开发注意事项

- **✅ 代码提交**: 必须遵循 Conventional Commits 规范，所有代码都要通过 ESLint 检查
- **模块独立**: 各AI工具模块要保持独立，避免功能耦合
- **类型安全**: 所有API调用和数据结构都要有TypeScript类型定义
- **错误处理**: 统一的错误处理机制，特别是AI模型调用失败的情况
- **性能考虑**: 大文件处理和AI模型调用的性能优化

### 质量标准

- **✅ 代码风格**: 所有代码必须通过 ESLint 和 Prettier 检查
- **✅ 提交质量**: 每次提交都要有清晰的说明，遵循规范格式
- **功能完整**: 每个功能都要有完整的错误处理和用户反馈
- **文档更新**: 重要变更都要更新相应的文档
- **测试覆盖**: 核心功能要有相应的测试用例
